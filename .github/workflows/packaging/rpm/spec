Name:           ezfirewall
Version:        __VERSION__
Release:        stable
Summary:        Ezfirewall is a simple nftables firewall script written in Python. It allows you to easily manage your firewall rules with YAML files.

BuildArch:      noarch
License:        GPL-3.0
URL:            https://github.com/lbr38/ezfirewall

Requires: nftables
Requires: python3
Requires: python3-colorama
Requires: python3-yaml
Requires: python3-tabulate

%description
Ezfirewall is a simple nftables firewall script written in Python. It allows you to easily manage your firewall rules with YAML files.

%prep

%install
# Copy local files to the rpm build directory
install -m 0750 -d $RPM_BUILD_ROOT/opt/
cp -r /opt/ezfirewall $RPM_BUILD_ROOT/opt/

%post
# Set permissions
chmod 750 /opt/ezfirewall
chown root:root /opt/ezfirewall

# Create a symlink for the ezfirewall command
if [ ! -L "/usr/local/bin/ezfirewall" ]; then
    ln -s /opt/ezfirewall/ezfirewall.py /usr/local/bin/ezfirewall
fi

# Deploy rsyslog configuration for ezfirewall
if [ -d /etc/rsyslog.d ]; then
    \cp /opt/ezfirewall/templates/nftables-rsyslog /etc/rsyslog.d/nftables.conf
    chmod 644 /etc/rsyslog.d/nftables.conf

    # Restart rsyslog if it is running
    if systemctl is-active --quiet rsyslog; then
        systemctl restart rsyslog --quiet
    fi
fi

# Deploy logrotate configuration for nftables drop logs
if [ -d /etc/logrotate.d ]; then
    \cp /opt/ezfirewall/templates/nftables-logrotate /etc/logrotate.d/nftables
    chmod 644 /etc/logrotate.d/nftables
fi

%files
/opt/ezfirewall/

%changelog